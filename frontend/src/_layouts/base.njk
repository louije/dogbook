<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }} - Trombi Maisons-Doggo</title>
  <meta name="description" content="Le trombi des chiens du coin">

  <meta property="og:title" content="{{ title }} - Trombi Maisons-Doggo">
  <meta property="og:description" content="Le trombi des chiens du coin">
  <meta property="og:type" content="website">
  {% if dogImage %}
  <meta property="og:image" content="{{ dogImage }}">
  {% else %}
  <meta property="og:image" content="{{ metadata.url }}/images/packshot.jpg">
  {% endif %}

  <link rel="stylesheet" href="/css/main.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2c5f2d">
  <link rel="apple-touch-icon" href="/images/hello-big-dog.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/images/hello-dog.png">
  <link rel="icon" type="image/png" sizes="1024x1024" href="/images/hello-big-dog.png">
</head>
<body>

  <main class="main">
    {{ content | safe }}
  </main>

  <script>
    // Pass API URL to client-side scripts
    window.API_URL = '{{ metadata.apiUrl or "http://localhost:3000" }}';

    // Pass text/UI configuration to client-side scripts
    window.APP_TEXT = {{ text | dump | safe }};
  </script>
  <script src="/js/snow.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/upload.js"></script>
  <script src="/js/featured-photo.js"></script>

  <!-- Magic auth and edit functionality -->
  <script type="module">
    import { initMagicAuth } from '/js/magic-auth.js';
    import { EditDogModal } from '/js/edit-dog.js';
    import { EditOwnerModal } from '/js/edit-owner.js';

    // Initialize magic auth on page load
    initMagicAuth(window.APP_TEXT);

    // Make modals globally available for button onclick handlers
    window.dogModal = null;
    window.ownerModal = null;

    // Initialize modals when buttons appear (after magic auth enables them)
    document.addEventListener('DOMContentLoaded', () => {
      window.dogModal = new EditDogModal(window.APP_TEXT);
      window.ownerModal = new EditOwnerModal(window.APP_TEXT);
    });

    // Global functions for edit buttons
    window.openAddDogModal = () => {
      if (window.dogModal) window.dogModal.open();
    };

    window.openEditDogModal = (dogData) => {
      if (window.dogModal) {
        window.dogModal.open(dogData);
      }
    };

    window.openEditOwnerModal = (ownerData) => {
      if (window.ownerModal) {
        window.ownerModal.open(ownerData);
      }
    };
  </script>
</body>
</html>
