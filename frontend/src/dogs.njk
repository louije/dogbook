---
pagination:
  data: dogs
  size: 1
  alias: dog
permalink: "/chiens/{{ dog.id }}/"
layout: base.njk
eleventyComputed:
  title: "{{ dog.name }}"
  year: 2024
  dogImage: "{{ dog | getFeaturedPhoto }}"
---

<article class="dog-detail">
  <div class="dog-detail__container">
    <a href="/" class="dog-detail__back">‚Üê Retour</a>

    <div class="dog-detail__header">
      <h1 class="dog-detail__name">{{ dog.name }}</h1>
      <div class="dog-detail__tags">
        {% if dog.owner %}
        <span class="dog-tag">{{ dog.owner.name }}</span>
        {% endif %}
        {% if dog.sex %}
        <span class="dog-tag">{{ 'M√¢le' if dog.sex === 'male' else 'Femelle' }}</span>
        {% endif %}
        {% if dog.breed %}
        <span class="dog-tag">{{ dog.breed }}</span>
        {% endif %}
        {% if dog.coat %}
        <span class="dog-tag">{{ dog.coat }}</span>
        {% endif %}
        <a href="{{ dog.id | editUrl }}" target="_blank" rel="noopener" class="dog-tag dog-tag--edit" title="Modifier cette fiche">‚úèÔ∏è</a>
      </div>
    </div>

    <div class="dog-detail__content">
      <div class="dog-detail__main">
        <button class="dog-detail__image-button" data-image="{{ dog | getFeaturedPhoto }}" data-alt="{{ dog.name }}">
          <img
            src="{{ dog | getFeaturedPhoto }}"
            alt="{{ dog.name }}"
            class="dog-detail__image"
          >
        </button>

        <!-- Mobile Photo Upload Section -->
        <section class="photo-upload">
          <h2 class="photo-upload__title">Ajouter une photo</h2>
          <form id="upload-form" class="photo-upload__form" data-dog-id="{{ dog.id }}">
            <label for="photo-input" class="photo-upload__label">
              <span class="photo-upload__icon">üì∑</span>
              <span class="photo-upload__text">Choisir une photo</span>
              <input
                type="file"
                id="photo-input"
                name="photo"
                accept="image/*"
                capture="environment"
                class="photo-upload__input"
                required
              >
            </label>

            <div id="preview-container" class="photo-upload__preview" hidden>
              <img id="preview-image" class="photo-upload__preview-image" alt="Aper√ßu">
              <button type="button" id="remove-preview" class="photo-upload__remove" aria-label="Supprimer">√ó</button>
            </div>

            <button type="submit" id="upload-button" class="photo-upload__submit" disabled>
              Envoyer
            </button>

            <div id="upload-progress" class="photo-upload__progress" hidden>
              <div class="photo-upload__progress-bar">
                <div id="progress-fill" class="photo-upload__progress-fill"></div>
              </div>
              <p id="progress-text" class="photo-upload__progress-text">Envoi en cours...</p>
            </div>

            <div id="upload-status" class="photo-upload__status"></div>
          </form>
        </section>
      </div>

      {% if dog.photos.length > 0 %}
      <aside class="dog-detail__sidebar">
        <div class="dog-gallery">
          <h3 class="dog-gallery__title">Galerie photos</h3>
          <div class="dog-gallery__grid">
            {% for photo in dog.photos %}
              {% if photo.type === 'photo' and photo.file %}
              <div class="dog-gallery__item-wrapper">
                <button class="dog-gallery__item" data-image="{{ photo.file.url | imageUrl }}" data-alt="{{ photo.name or dog.name }}">
                  <img
                    src="{{ photo.file.url | imageUrl }}"
                    alt="{{ photo.name or dog.name }}"
                    class="dog-gallery__image"
                    loading="lazy"
                  >
                </button>
                <button
                  class="dog-gallery__set-featured"
                  data-photo-id="{{ photo.id }}"
                  data-dog-id="{{ dog.id }}"
                  title="D√©finir comme photo principale"
                >
                  ‚≠ê
                </button>
              </div>
              {% elif photo.type === 'video' and photo.videoUrl %}
              <div class="dog-gallery__item dog-gallery__item--video">
                <a href="{{ photo.videoUrl }}" target="_blank" class="dog-gallery__video-link">
                  üìπ Vid√©o
                </a>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </aside>
      {% endif %}
    </div>
  </div>
</article>

<dialog id="lightbox" class="lightbox">
  <button class="lightbox__close" aria-label="Fermer">&times;</button>
  <img src="" alt="" class="lightbox__image">
</dialog>
